---
title: 正则表达式
date: 2021-07-03
tags: 
    - js
    - javascript
    - regexp
    - 正则
    - 正则表达式
    - 字符匹配
---
## 简介
正则表达式为字符串而生，用来表示字符串的组成结构，因此通过正则表达式可以判断字符串是否符合某个字符排列模式或者对字符串进行指定的替换。正则表达式并不是`javascript`中的特性，其他语言中也有实现正则表达式，并且语法相一致，只是对于语法解析的支持程度不一（如ES5不支持u修饰符），因此学会了js中的正则也可以用到其他语言中。
## 正则语法
### 创建
可通过`RegExp`对象创建正则表达式对象，如`new RgeEXp('js', 'g')`即可创建正则表达式，第一个参数为表达式主体内容，表示“带匹配字符串有js这个字符串片段”，第二个参数为修饰符('g'表示进行全局匹配)。

常用的创建方式是通过字面量创建，上述正则表达式对象可通过`/js/g`创建。两者并不完全一样，尤其涉及到全局匹配时。
### 字面量匹配字符
所有字母字符和数字字符都匹配自身的字面值（它是啥就匹配啥）。通过`\`可对字符进行转义，使她具备特殊匹配模式。如`\n`不匹配反斜杠和n而是匹配换行符。其余如下表：
|      字符     |       匹配目标        |
|:-:|:-:|
|\t|制表符|
|\n|换行符|
|\r|回车符|
|\uxxxx|16进制数xxxx所对应的Unicode字符|
|\s|任何Unicode空白字符|
|\S|任何非Unicode空白字符|
|\d|任何ascii数字字符|
|\D|任何非ascii数字字符|
|\w|任何字母字符或数字字符|
|\W|字母字符和数字字符之外的字符|
可以通过联系英文全称进行助记，如：tab、newline、return、space、digital、word，字母为大写时匹配除xxx之外的字符。

上述匹配方式匹配到多个选项中的某一个即可，同样的也有类似的语法，如：`/[abcd]/`会匹配一个字符，该字符应该是abcd中的某一个，也可写为`/[a-d]`，因此`\d`相当于`[0-9]`、`\w`相当于`[a-zA-Z0-9]`。`[^...]`会匹配括号子字符之外的字符，类似之前`\W`和`\D`。
### 重复
该语法可按照之前的匹配格式重复匹配。如`/liiii/`匹配到liiii，有重复匹配部分，可写为`/li{4,4}`，即可匹配到liiii。`{m,n}`语法中，m表示最少重复书，n表示最多重复数。一些特殊的规则如下：
|字符|含义|
|:-:|:-:|
|{n,}|匹配前项至少n次|
|{n}|匹配前项n次|
|?|匹配前项0或1次，也就是可有可无|
|+|至少匹配一次|
|*|匹配零次或多次|
例子如下：
``` javascript
/\d{4}\w/       //匹配4个数字一个字母
/\s+\w/         //匹配字母必须有前导空格
```
眼尖的同学已经注意到了，+?\*可表示重复次数，那么匹配+?\*的字面量，该怎么办呢？答案是万能的转义字符`\`，`/a\?/`即可匹配a?而不进行重复匹配。
### 分组和引用
`()`可以表示一个分组，分组可以表示一个子匹配模块。可将重复次数应用到分组后。分组匹配到的字符还可引用，如`/(abc)(123)\1\2/`，从左到右根据左括号出现顺序给分组编号，从1开始，一次(abc)为分组1切(123)为分组2，`\1`表示引用分组1匹配到的内容（注意引用的是分组匹配到内容，不是再按照匹配模式重新匹配）。

更为易于使用的命名分组，语法：`(?<name>content)`。如：`/(?<g1>abc)(?<g2>123)/`，两个组名字依次为g1和g2，匹配模式分别为abc和123。分组引用语法如：`\k<name>`。上述例子可写为`/(?<g1>abc)(?<g2>123)/`。
### 匹配位置
也可指定从什么位置开始匹配，也可理解为不匹配具体字符串而是匹配具体位置，如`^`指从字符串开头匹配。常见的如下：
|字符|含义|
|^|匹配字符串开头|
|$|匹配字符串末尾|
|\b|匹配单词边界，即\w和\w或\w和字符串开头或\w和字符串末尾的位置。|
|(?=p)|肯定式向前查找|
|(?!p)|否定式向前查找|
|(?<=p)|肯定式向后查找|
|(?<!p)|肯定式向后查找|
否定式与肯定式意义相反。
示例如下:
``` javascript
/^[a-zA-z]\w{6}/        //匹配以字母开头的7位字母数字混合字符串
/\w+.com$/              //匹配以.com结尾的长度大于5的字母数字混合字符串
/\bjavascript\b/        //匹配以左右两边有单词边界的javascript字符串，如"  javascript "
/app(?=le)/             //匹配到后面为le的app字符串，le不算在匹配结果中
/(?<=app)le/            //匹配前面为app的le字符串，app不算在匹配结果中
```
### 标志符
每个正则表达式可带多个标识符修饰匹配方式。

g即为全局匹配标志符，会强制的从后到尾匹配一遍，即使匹配项已经找到。

i表示匹配是不区分字符大小写。

m表示可进行多行匹配，这种模式下，`^`还可表示每一行开头，`$`还可表示每一行结尾。

u是和unicode相关的，使用`\u`是可以直接根据码点进行匹配，而不限于16位值。

y标志表示匹配应该是具有记忆性的，应在前一个匹配字符或者开头后面开始匹配。

标识符可以组合，不区分大小写。
## 字符串方法
目前基本了解了正则表达式语法，在javscript中使用正则表达式需要配合字符串方法或正则对象方法。这些方法包含模式匹配（待匹配字符串和正则表达式是否匹配）、字符串替换（根据正则表达式对字符串进行特定的替换和匹配项捕获（获取匹配到的字符串）。
### search 
该方法接收一个正则表达式作为参数，返回第一个匹配项起点的位置，没有匹配项则返回-1。如：
``` javascript
"appleandapp".search(/app/)         // => 0
"appleandapp".search(/bear/)        // => 1
```
如果接收的参数不是正则表达式，会将参数传入构造函数生成正则表达式。
### replace
该方法用于字符串的替换，第一个参数为正则表达式（用于寻找待替换的匹配项），第二个单数为字符串（用于替换匹配项）。该方法不会改变字符串本身，返回值为替换后的新字符串。如
``` javascript
"apple and bear".replace(/\bbear\b/, " banana ");       // => apple and banana
```
第二个参数可包含对捕获分组的引用，如:
``` javascript
"bananas and apple".replace(/\b(apple)\b/, "$1s");      // => bananas and appple
```
命名分组写法如下：
``` javascript
"bananas and apple".replace(/\b(?<apple>apple)\b/, "$<apple>s");    // => bananas and apples
```
如果有多个捕获分组时，可以第二个参数可为一个函数，该函数会接收匹配的文本、各个捕获组的匹配项及所在位置、命名捕获组匹配项的信息，更为强大。
### match
match可以获取到匹配到的子串，接收正则表达式作为参数，返回包含匹配项和捕获项的数组。可用于解析字符串中的参数。
## 正则表达式对象 
### 属性
- source，正则表达式的源文本，也就是斜杠之间的字符。
- flags，包含指定的所有标志符字符串。
- 标志符映射属性,如global、ignoreCase、multiline、dotAll、unicode、sticky，依次对应于标志符g、i、m、s、u、y。
- lastIndex，对于指定g或y标志符的匹配，该属性用于指定下一次匹配的起始字符位置，也是唯一一个可读可写属性，其他属性均为只读属性。
### 方法
#### exec
`exec`方法类似于字符串的`match`方法，返回包含匹配项信息的数组。在未设置g标志时，两者结果相同。设置g标志时，`match`返回数组中会包含所有匹配项信息。但`exec`仍旧每次只进行一次匹配，返回单个匹配项信息，但`lastIndex`会被更新，因此可以多次执行`exec`进行全局匹配。
#### test
`test`方法接收字符串参数，模式匹配成功则返回true，失败则返回false。`test`内部调用了`exec`，因此为设定g或y标志时，它的结果取决于`exec`是否有返回值。当设定了g或y标志时，它的结果取决于lastIndex是否为0。
## 结束
写着写着写不动了，语法的堆砌和各种特殊情况不容易用文字表达了，可以参考犀牛书、MDN或者其他的资料。


