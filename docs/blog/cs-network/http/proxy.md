---
title: http代理
date: 2020-05-13
next: false
tags:
    - http
    - 代理
---

在很多实际场景中，客户端和服务端并不是直接通信的。而是通过代理服务器转发请求，间接通信。其中的中间层服务器称为代理服务器，最终进行数据处理的服务器称为源服务器。
## 代理过程
一个简单的代理请求过程：
- 客户端向代理服务器发送请求。
- 代理服务器向源服务器发送请求。
- 源服务器进行处理向代理服务器返回响应。
- 代理服务器向客户端返回响应。

## 优点
- 后台服务器不直接与客户端通信，避免暴露IP地址，提升安全性。
- 有请求需要处理时，代理服务器可根据服务器集群的状态分配处理请求，有利于负载均衡、工作稳定。
- 可分层次加密，仅在在用户与代理服务器之间使用SSL加密，兼顾安全与速度。
- 代理服务器上也可进行简单的数据处理和资源缓存，提升效率，分担后台服务器压力。
## 相关字段
有的时候源服务器需要客户端的信息，如IP地址等。但代理服务都是两两之间的一对一通信。基于Http的灵活可拓展性，新的字段应运而生。
### Via
保存代理过程中的主机名及请求顺序。每经过一次代理，都会将当前主机名添加到Via属性值的最后。
### X-Forworded-For
Via字段只能保存主机名，X-Forworded-For则可以保存各级代理的IP地址。
### X-Real-IP
记录客户端的IP地址。
## 实例
一个简单代理情形

![响应报文首部](~@blogImg/proxy-res.png)

![服务器通过代理依然获取到客户端信息](~@blogImg/proxy-getInfo.png)
## 代理协议
上述方法虽然最终可获取到客户端IP，但需要层层解析报文首部字段，有明显性能损耗

于是出现了代理协议，在Http报文前添加信息行，从左到右依次包含“Proxy”、请求方IP类型、请求方地址、应答方地址、请求方端口号、应答方端口号和换行符。

在获取客户端IP时只需解析信息行即可。



